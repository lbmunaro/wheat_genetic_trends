<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lucas Berger Munaro">
<meta name="author" content="Jessica E. Rutkoski">

<title>Genetic trends due to 21 years of winter wheat breeding in IL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="wheat_genetic_trends_files/libs/clipboard/clipboard.min.js"></script>
<script src="wheat_genetic_trends_files/libs/quarto-html/quarto.js"></script>
<script src="wheat_genetic_trends_files/libs/quarto-html/popper.min.js"></script>
<script src="wheat_genetic_trends_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="wheat_genetic_trends_files/libs/quarto-html/anchor.min.js"></script>
<link href="wheat_genetic_trends_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="wheat_genetic_trends_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="wheat_genetic_trends_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="wheat_genetic_trends_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="wheat_genetic_trends_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="wheat_genetic_trends_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="wheat_genetic_trends_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Genetic trends due to 21 years of winter wheat breeding in IL</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Lucas Berger Munaro </p>
             <p>Jessica E. Rutkoski </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="clean-workspace" class="level2">
<h2 class="anchored" data-anchor-id="clean-workspace">Clean workspace</h2>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># R packages for data science</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor) <span class="co"># Simple Tools for Examining and Cleaning Dirty Data</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(asreml) <span class="co"># ASReml-R package</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(asremlPlus) <span class="co"># Augments 'ASReml-R'</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># Create HTML Table</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot) <span class="co"># A visualization of a correlation matrix</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext) <span class="co"># Improved text rendering support for ggplot2</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">asreml.options</span>(<span class="at">trace=</span>F, <span class="co"># Report convergence monitoring</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">maxit=</span><span class="dv">250</span>) <span class="co"># Maximum number of iterations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="phenotypic-data" class="level2">
<h2 class="anchored" data-anchor-id="phenotypic-data">Phenotypic data</h2>
<section id="raw-data" class="level3">
<h3 class="anchored" data-anchor-id="raw-data">Raw data</h3>
<p>Read, clean, and organize data from the Breedbase</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dat1w <span class="ot">&lt;-</span> <span class="co">#raw data wide format</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="st">'data/gen_trend_dat_2022nov10.csv'</span>, <span class="at">skip =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="st">'cols'</span>)) <span class="sc">|&gt;</span><span class="co">#remove columns entirely empty</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> <span class="co"># clean names</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select variables to be used</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(observation_unit_name,study_name,study_year,location_name,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>         block_number, row_number, col_number, germplasm_name,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         heading_time_julian_date_jd_co_321_0001233,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         plant_height_cm_co_321_0001301,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         grain_yield_kg_ha_co_321_0001218,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>         grain_test_weight_g_l_co_321_0001210) <span class="sc">|&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename variables</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id=</span>observation_unit_name,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">year=</span>study_year,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">loc=</span>location_name,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">env=</span>study_name,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">blk=</span>block_number,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">row=</span>row_number,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span>col_number,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">gen=</span>germplasm_name,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">heading_time=</span>heading_time_julian_date_jd_co_321_0001233,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">plant_height=</span>plant_height_cm_co_321_0001301,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">grain_yield=</span>grain_yield_kg_ha_co_321_0001218,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">test_weight=</span>grain_test_weight_g_l_co_321_0001210) <span class="sc">|&gt;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year,loc,gen,blk,row,col) <span class="sc">|&gt;</span> <span class="co">#arrange data</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace location name</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loc =</span> <span class="fu">str_replace</span>(loc,<span class="st">'St. Jacob Township, IL'</span>,<span class="st">'St. Jacob, IL'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to factors</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(id<span class="sc">:</span>gen),as.factor) <span class="sc">|&gt;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to numeric</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(heading_time<span class="sc">:</span>test_weight),as.numeric) <span class="sc">|&gt;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace 0 by NA for response variables</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(heading_time<span class="sc">:</span>test_weight), <span class="sc">~</span><span class="fu">ifelse</span>(.<span class="sc">==</span><span class="dv">0</span>,<span class="cn">NA</span>,.)) <span class="sc">|&gt;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter out AdvHY trials (Advanced High Yield trial)</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">'AdvHY'</span>,env)) <span class="sc">|&gt;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop unused levels</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 27,884
Columns: 12
$ id           &lt;fct&gt; Adv_Brt_01-plot1018, Adv_Brt_01-plot2016, Adv_Brt_01-plot…
$ env          &lt;fct&gt; Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_0…
$ year         &lt;fct&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 200…
$ loc          &lt;fct&gt; "Brownstown, IL", "Brownstown, IL", "Brownstown, IL", "Br…
$ blk          &lt;fct&gt; 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, …
$ row          &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ col          &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ gen          &lt;fct&gt; 87-2834-1, 87-2834-1, 87-2834-1, 94-1653, 94-1653, 94-165…
$ heading_time &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ plant_height &lt;dbl&gt; 86.36, 91.44, 86.36, 78.74, 76.20, 68.58, 81.28, 78.74, 8…
$ grain_yield  &lt;dbl&gt; 4573.062, 5548.200, 5198.495, 4445.285, 4727.739, 3443.24…
$ test_weight  &lt;dbl&gt; 751.7237, 759.4469, 747.8621, 701.5230, 728.5541, 720.830…</code></pre>
</div>
</div>
<p>Raw data 1 long format</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dat1l <span class="ot">&lt;-</span> dat1w <span class="sc">|&gt;</span> <span class="co">#raw data long format</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> heading_time<span class="sc">:</span>test_weight,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">'var'</span>, <span class="co">#variables</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">'val'</span>, <span class="co">#values</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> T) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var=</span><span class="fu">as.factor</span>(var)) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 67,362
Columns: 10
$ id   &lt;fct&gt; Adv_Brt_01-plot1018, Adv_Brt_01-plot1018, Adv_Brt_01-plot1018, Ad…
$ env  &lt;fct&gt; Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_B…
$ year &lt;fct&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001,…
$ loc  &lt;fct&gt; "Brownstown, IL", "Brownstown, IL", "Brownstown, IL", "Brownstown…
$ blk  &lt;fct&gt; 1, 1, 1, 2, 2, 2, 3, 3, 3, 1, 1, 1, 2, 2, 2, 3, 3, 3, 1, 1, 1, 2,…
$ row  &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ col  &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ gen  &lt;fct&gt; 87-2834-1, 87-2834-1, 87-2834-1, 87-2834-1, 87-2834-1, 87-2834-1,…
$ var  &lt;fct&gt; plant_height, grain_yield, test_weight, plant_height, grain_yield…
$ val  &lt;dbl&gt; 86.3600, 4573.0619, 751.7237, 91.4400, 5548.2001, 759.4469, 86.36…</code></pre>
</div>
</div>
</section>
</section>
<section id="data-summary" class="level2">
<h2 class="anchored" data-anchor-id="data-summary">Data summary</h2>
<section id="number-of-observations-per-trait" class="level3">
<h3 class="anchored" data-anchor-id="number-of-observations-per-trait">Number of observations per trait</h3>
<p>Number of years (Year), locations (Loc), environments (Env), genotypes (Gen), total observations (Obs)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dat1l <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(var) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot=</span><span class="fu">length</span>(id)) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">nyear=</span><span class="fu">length</span>(<span class="fu">unique</span>(year)),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">nloc=</span><span class="fu">length</span>(<span class="fu">unique</span>(loc)),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">nenv=</span><span class="fu">length</span>(<span class="fu">unique</span>(env)),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">ngen=</span><span class="fu">length</span>(<span class="fu">unique</span>(gen)),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">tot=</span><span class="fu">unique</span>(tot)) <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var=</span><span class="fu">c</span>(<span class="st">'Grain yield'</span>, <span class="st">'Heading time'</span>, <span class="st">'Plant height'</span>, <span class="st">'Test weight'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">"tables/table1.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">'Phenotypic variable'</span>,<span class="st">'No. Years'</span>,<span class="st">'No. Loc'</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'No. Env'</span>,<span class="st">'No. Gen'</span>,<span class="st">'No. Obs'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Phenotypic variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">No. Years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">No. Loc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">No. Env</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">No. Gen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">No. Obs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grain yield</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">1690</td>
<td style="text-align: right;">27842</td>
</tr>
<tr class="even">
<td style="text-align: left;">Heading time</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1690</td>
<td style="text-align: right;">7534</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Plant height</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">1690</td>
<td style="text-align: right;">14004</td>
</tr>
<tr class="even">
<td style="text-align: left;">Test weight</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">1690</td>
<td style="text-align: right;">17982</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(dat1l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 67362</code></pre>
</div>
</div>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|fig.height=4, fig.width=12</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dat1l <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,loc,var) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">no_gen=</span><span class="fu">length</span>(<span class="fu">unique</span>(gen))) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> loc,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> no_gen) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">'loc'</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">'no_gen'</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">cols =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year,loc)) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>no_gen), <span class="at">color=</span><span class="st">'black'</span>, <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>var, </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller=</span><span class="fu">labeller</span>(<span class="at">var=</span><span class="fu">c</span>(<span class="st">'grain_yield'</span><span class="ot">=</span><span class="st">'Grain yield'</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">'heading_time'</span><span class="ot">=</span><span class="st">'Heading time'</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">'plant_height'</span><span class="ot">=</span><span class="st">'Plant height'</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">'test_weight'</span><span class="ot">=</span><span class="st">'Test weight'</span>))) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">name =</span> <span class="st">'Number of </span><span class="sc">\n</span><span class="st">genotypes'</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">'#FF552E'</span>, <span class="at">low =</span> <span class="st">'#13294B'</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.value=</span><span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Year'</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">'Location'</span>) <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">vjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>), <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year', 'loc'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="wheat_genetic_trends_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/traits_loc.tiff"</span>, <span class="at">width =</span> <span class="fl">6.5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">dpi=</span><span class="dv">320</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="single-trial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="single-trial-analysis">Single trial analysis</h2>
<p>Single trial analysis, within trial or environment</p>
<section id="blup-model" class="level3">
<h3 class="anchored" data-anchor-id="blup-model">BLUP model</h3>
<p>BLUP models to calculate blup for each genotype within trial, blups will be used to calculate reliability</p>
<p>Model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mod.blups <span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(dat){</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    yr <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(dat<span class="sc">$</span>year)) <span class="co"># year being analyzed</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">'2021'</span> <span class="sc">%in%</span> yr){</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Model for 2021 (including row and column)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        mod <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed =</span> val<span class="sc">~</span><span class="dv">1</span><span class="sc">+</span>blk,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="sc">~</span>gen<span class="sc">+</span>row<span class="sc">+</span>col,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dat, <span class="at">na.action =</span> <span class="fu">na.method</span>(<span class="at">y=</span><span class="st">'include'</span>, <span class="at">x=</span><span class="st">'include'</span>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Model for other years (2001 to 2020)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        mod <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed =</span> val<span class="sc">~</span><span class="dv">1</span><span class="sc">+</span>blk,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">random =</span> <span class="sc">~</span>gen,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dat, <span class="at">na.action =</span> <span class="fu">na.method</span>(<span class="at">y=</span><span class="st">'include'</span>, <span class="at">x=</span><span class="st">'include'</span>))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update model</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">update</span>(mod)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Blups</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  blups<span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">classify=</span><span class="st">'gen'</span>, <span class="at">ignore=</span><span class="fu">c</span>(<span class="st">'(Intercept)'</span>,<span class="st">'blk'</span>))<span class="sc">$</span>pvals</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prediction error variance</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  pev<span class="ot">&lt;-</span> blups[,<span class="st">'std.error'</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Genetic variance</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  Vg<span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>varcomp[<span class="st">'gen'</span>,<span class="st">'component'</span>]</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reliability for each gen</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  rel<span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>(pev<span class="sc">/</span>Vg)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mean reliability</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  m_rel<span class="ot">&lt;-</span> <span class="fu">mean</span>(rel)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Result</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  res<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">m_rel=</span>m_rel)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Result that will be printed</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>out_blups <span class="ot">&lt;-</span> dat1l<span class="sc">|&gt;</span> <span class="co"># raw data long format</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group by env and var</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(env,var) <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number of blocks within env and var</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">no_blk=</span><span class="fu">length</span>(<span class="fu">unique</span>(blk))) <span class="sc">|&gt;</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove the ones with only one block</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(no_blk<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove no_blk column</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>no_blk) <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run the model for each combination of env and var using the function</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">blups=</span><span class="fu">map</span>(data,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>             <span class="sc">~</span><span class="fu">mod.blups</span>(.x))) <span class="sc">|&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unnest reliability</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(blups) <span class="sc">|&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># round reliability</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric,<span class="sc">~</span><span class="fu">round</span>(.,<span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `blups = map(data, ~mod.blups(.x))`.
ℹ In group 79: `env = Adv_Neo_20`, `var = test_weight`.
Caused by warning in `asreml()`:
! Some components changed by more than 1% on the last iteration
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 198
Columns: 4
$ env   &lt;fct&gt; Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Car_01, Adv_Stj_01, Adv_…
$ var   &lt;fct&gt; plant_height, grain_yield, test_weight, grain_yield, grain_yield…
$ data  &lt;list&gt; [&lt;tbl_df[360 x 8]&gt;], [&lt;tbl_df[342 x 8]&gt;], [&lt;tbl_df[360 x 8]&gt;], …
$ m_rel &lt;dbl&gt; 0.708, 0.321, 0.806, 0.798, 0.708, 0.952, 0.866, 0.768, 0.866, 0…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>out_blups <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(data)) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(var) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">min=</span><span class="fu">min</span>(m_rel),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">max=</span><span class="fu">max</span>(m_rel),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean=</span><span class="fu">mean</span>(m_rel),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">median=</span>(<span class="fu">median</span>(m_rel))) <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">round</span>(.,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  var            min   max  mean median
  &lt;fct&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 grain_yield   0     0.92  0.65   0.69
2 heading_time  0.52  0.97  0.9    0.92
3 plant_height  0.44  0.94  0.82   0.83
4 test_weight   0     0.93  0.78   0.84</code></pre>
</div>
</div>
<section id="boxplot---single-trial-reliability" class="level4">
<h4 class="anchored" data-anchor-id="boxplot---single-trial-reliability">Boxplot - single trial reliability</h4>
<p>Boxplot showing the reliability</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>out_blups  <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(data)) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(var) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mrel=</span><span class="fu">format</span>(<span class="fu">round</span>(<span class="fu">mean</span>(m_rel),<span class="dv">2</span>),<span class="at">nsmall=</span><span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>var,<span class="at">y=</span>m_rel)) <span class="sc">+</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill=</span><span class="st">'#FF552E'</span>,<span class="at">color=</span><span class="st">'#13294B'</span>,<span class="at">width=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fu">as.numeric</span>(mrel)),<span class="at">shape=</span><span class="dv">4</span>, <span class="at">size=</span><span class="dv">2</span>, <span class="at">color=</span><span class="st">'#13294B'</span>) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Reliability"</span>) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">expand=</span><span class="fu">c</span>(<span class="fl">0.01</span>,<span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">'Grain yield'</span>,<span class="st">'Heading time'</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Plant height'</span>,<span class="st">'Test weight'</span>)) <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">vjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">'none'</span>, <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="wheat_genetic_trends_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/r2.tiff"</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">dpi=</span><span class="dv">320</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="blue-model" class="level3">
<h3 class="anchored" data-anchor-id="blue-model">BLUE model</h3>
<p>Estimate genotype blues and weights within each trial</p>
<p>Model::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mod.blues <span class="ot">&lt;-</span> <span class="co"># Function name</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(dat){</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>        yr <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(dat<span class="sc">$</span>year)) <span class="co"># year being analyzed</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">'2021'</span> <span class="sc">%in%</span> yr){</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Model for 2021 (including row and column)</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        mod <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed =</span> val<span class="sc">~</span><span class="dv">1</span><span class="sc">+</span>gen<span class="sc">+</span>blk,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="sc">~</span>row<span class="sc">+</span>col,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dat,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">na.action =</span> <span class="fu">na.method</span>(<span class="at">y=</span><span class="st">'include'</span>, <span class="at">x=</span><span class="st">'include'</span>))</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Model for other years (2001 to 2020)</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        mod <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed =</span> val<span class="sc">~</span><span class="dv">1</span><span class="sc">+</span>gen<span class="sc">+</span>blk,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dat,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">na.action =</span> <span class="fu">na.method</span>(<span class="at">y=</span><span class="st">'include'</span>, <span class="at">x=</span><span class="st">'include'</span>))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update model</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">update</span>(mod)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Blues</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  blues<span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">classify=</span><span class="st">'gen'</span>)<span class="sc">$</span>pvals</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Result</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(blues)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run model and organize output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>out_blues <span class="ot">&lt;-</span> <span class="co"># create df with blues</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  out_blups <span class="sc">|&gt;</span> <span class="co"># previous model output</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unnest draw data used in previous model</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group by env and var</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(env,var) <span class="sc">|&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># nest by each combination of env and var</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run the model for each combination of env and var using the function</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">blues=</span><span class="fu">map</span>(data,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>             <span class="sc">~</span><span class="fu">mod.blues</span>(.x))) <span class="sc">|&gt;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove raw data</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">|&gt;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unnest blues</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(blues) <span class="sc">|&gt;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clean and rename variables</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">prd_val=</span>predicted_value) <span class="sc">|&gt;</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove status column</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>status) <span class="sc">|&gt;</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add year and location columns by env</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat1l <span class="sc">|&gt;</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(env) <span class="sc">|&gt;</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(<span class="at">year=</span><span class="fu">unique</span>(year),</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                        <span class="at">loc=</span><span class="fu">unique</span>(loc)),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span><span class="st">'env'</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `blues = map(data, ~mod.blues(.x))`.
ℹ In group 196: `env = Adv_Urb_21`, `var = heading_time`.
Caused by warning in `asreml()`:
! Some components changed by more than 1% on the last iteration</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 24,059
Columns: 7
Groups: env, var [198]
$ env       &lt;fct&gt; Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, …
$ var       &lt;fct&gt; plant_height, plant_height, plant_height, plant_height, plan…
$ gen       &lt;fct&gt; 87-2834-1, 94-1653, 94-1909, 94-2529W, 94-2667, 94-6522, 94-…
$ prd_val   &lt;dbl&gt; 88.05333, 74.50667, 82.12667, 75.35333, 77.89333, 79.58667, …
$ std_error &lt;dbl&gt; 2.974737, 2.974737, 2.974737, 2.974737, 2.974737, 2.974737, …
$ year      &lt;fct&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ loc       &lt;fct&gt; "Brownstown, IL", "Brownstown, IL", "Brownstown, IL", "Brown…</code></pre>
</div>
</div>
<section id="test-weight-imputation" class="level4">
<h4 class="anchored" data-anchor-id="test-weight-imputation">Test weight imputation</h4>
<p>In 5 trials test weight was evaluated in only one replication. Because of that it was excluded from the single trials models. To be able to add these observations to the genetic trend analyses we used the test weight from the single replication and the average standard error from all trials before 2014. We did not use data from 2014 and later because the measurement method was different and all trials with information from only one replication were prior to 2014.</p>
<p>Trials with test weight data from only one replication</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dat1l<span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(env,var) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">no_blk=</span><span class="fu">length</span>(<span class="fu">unique</span>(blk))) <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(no_blk<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, loc) <span class="sc">|&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5
Columns: 2
$ year &lt;fct&gt; 2001, 2001, 2006, 2006, 2013
$ loc  &lt;fct&gt; "Carmi, IL", "St. Jacob, IL", "Carmi, IL", "St. Jacob, IL", "Urba…</code></pre>
</div>
</div>
<p>Average standard error for test weight standard error from 2001 to 2013 for imputation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tw.std_error <span class="ot">&lt;-</span> out_blues <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(var<span class="sc">==</span><span class="st">'test_weight'</span><span class="sc">&amp;</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(year))<span class="sc">&lt;</span><span class="dv">2014</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">se=</span><span class="fu">sqrt</span>(<span class="fu">mean</span>((std_error<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="dv">3</span>))) <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(<span class="at">use.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a long format data set with blues and standard errors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>blues <span class="ot">&lt;-</span> <span class="co"># long format df with blues and standard errors</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  out_blues <span class="sc">|&gt;</span> <span class="co"># blues output</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add trials with test weight data from only one block and mean standard error</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(dat1l<span class="sc">|&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(env,var) <span class="sc">|&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">no_blk=</span><span class="fu">length</span>(<span class="fu">unique</span>(blk))) <span class="sc">|&gt;</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(no_blk<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">prd_val=</span>val,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">std_error=</span>tw.std_error) <span class="sc">|&gt;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(env,var,gen,prd_val,std_error,year,loc)) <span class="sc">|&gt;</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group by gen to create new columns and organize the data</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gen) <span class="sc">|&gt;</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gen=</span><span class="fu">as.factor</span>(gen), <span class="co"># change to factor</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>         <span class="co"># create gidyr (first year the genotype entered the trial)</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr=</span><span class="fu">min</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(year))), </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>         <span class="co"># first year 2001 we consider IL-98 lines as first entry</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr=</span><span class="fu">ifelse</span>(gidyr<span class="sc">!=</span><span class="dv">2001</span>,gidyr,<span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">'^98'</span>,gen),<span class="dv">2001</span>,<span class="cn">NA</span>)), </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>         <span class="co"># add NA to gidyr of gen we will exclude from the analysis</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>         <span class="do">## NA if not starts with number (not IL) </span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr=</span><span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">'^</span><span class="sc">\\</span><span class="st">d'</span>,gen),<span class="cn">NA</span>,gidyr), </span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>         <span class="co">#IL gen that starts with US</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr=</span><span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">'^US'</span>,gen),</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">min</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(year))),gidyr), </span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr=</span><span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">'B-B'</span>,gen),<span class="cn">NA</span>,gidyr), <span class="co"># (not IL)</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr=</span><span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">'^96'</span>,gen),<span class="cn">NA</span>,gidyr), <span class="co"># (first entered before 2001)</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr=</span><span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">'^97'</span>,gen),<span class="cn">NA</span>,gidyr), <span class="co"># (first entered before 2001)</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>         <span class="do">## gidyr for Kaskaskia = 1993 based on the line name (90-7514)</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr=</span><span class="fu">ifelse</span>(gen<span class="sc">==</span><span class="st">'Kaskaskia'</span>,<span class="dv">1993</span>,gidyr), </span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr=</span><span class="fu">as.factor</span>(gidyr), <span class="co"># change to factor</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_n=</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(year)), <span class="co"># numeric year</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">gidyr_n=</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(gidyr)), <span class="co"># numeric gidyr</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt=</span>(<span class="dv">1</span><span class="sc">/</span>(std_error<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">|&gt;</span> <span class="co"># weights to include in the models</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> <span class="co"># ungroup</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(env,year,year_n,loc,gen,<span class="co">#check,check_f,</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>                gidyr,gidyr_n,</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>                var,prd_val,std_error,wt) <span class="sc">|&gt;</span> <span class="co"># select variables</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year,loc,gen,var) <span class="sc">|&gt;</span> <span class="co"># arrange data</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="genetic-correlation-among-traits" class="level2">
<h2 class="anchored" data-anchor-id="genetic-correlation-among-traits">Genetic correlation among traits</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Include the NA’s to the blues data set for the genetic correlation model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>blues.na <span class="ot">&lt;-</span> blues <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(std_error,wt)) <span class="sc">|&gt;</span> <span class="co"># filter out to make it easier to pivot wider</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> prd_val, <span class="at">names_from =</span> var) <span class="sc">|&gt;</span> <span class="co">#pivot wider (add NA)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to=</span><span class="st">'var'</span>, <span class="at">values_to=</span><span class="st">'prd_val'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">cols=</span><span class="fu">c</span>(grain_yield<span class="sc">:</span>heading_time), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> F) <span class="sc">|&gt;</span> <span class="co"># pivot longer without dropping NA's</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(blues) <span class="sc">|&gt;</span> <span class="co"># add back std_error and weights</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character,as.factor) <span class="sc">|&gt;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(var,env,gen) <span class="sc">|&gt;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(env, year, year_n, loc, gen, gidyr, gidyr_n, var,
prd_val)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 39,172
Columns: 11
$ env       &lt;fct&gt; Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, …
$ year      &lt;fct&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ year_n    &lt;dbl&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ loc       &lt;fct&gt; "Brownstown, IL", "Brownstown, IL", "Brownstown, IL", "Brown…
$ gen       &lt;fct&gt; 87-2834-1, 94-1653, 94-1909, 94-2529W, 94-2667, 94-6522, 94-…
$ gidyr     &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ gidyr_n   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ var       &lt;fct&gt; grain_yield, grain_yield, grain_yield, grain_yield, grain_yi…
$ prd_val   &lt;dbl&gt; 5106.586, 4205.424, 5160.387, 4308.542, 4763.606, 5303.855, …
$ std_error &lt;dbl&gt; 334.7391, 334.7391, 334.7391, 334.7391, 334.7391, 334.7391, …
$ wt        &lt;dbl&gt; 8.924569e-06, 8.924569e-06, 8.924569e-06, 8.924569e-06, 8.92…</code></pre>
</div>
</div>
</section>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model">Model</h3>
<p>Multi-trait model for the genetic correlations among traits</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mt_mod <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed =</span> prd_val<span class="sc">~</span>var,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(var)<span class="sc">:</span>gen <span class="sc">+</span> env<span class="sc">:</span>var <span class="sc">+</span> gen<span class="sc">:</span>env<span class="sc">:</span>var,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family=</span><span class="fu">asr_gaussian</span>(<span class="at">dispersion =</span> <span class="dv">1</span>),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">residual=</span> <span class="sc">~</span>units<span class="sc">:</span>var, </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.action =</span> <span class="fu">na.method</span>(<span class="at">y=</span><span class="st">'include'</span>, <span class="at">x=</span><span class="st">'include'</span>), </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">asmv=</span>var, <span class="at">data=</span>blues.na, <span class="at">weights=</span>wt,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">workspace=</span><span class="st">'1gb'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : US updates modified 1 times in iteration 1 to remain positive
definite.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : US updates modified 1 times in iteration 2 to remain positive
definite.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : US updates modified 1 times in iteration 3 to remain positive
definite.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : No EM update of constrained US structure

Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : No EM update of constrained US structure</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : US updates modified 1 times in iteration 4 to remain positive
definite.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : No EM update of constrained US structure

Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : No EM update of constrained US structure</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : US updates modified 1 times in iteration 5 to remain positive
definite.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : No EM update of constrained US structure

Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : No EM update of constrained US structure</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : US updates modified 1 times in iteration 6 to remain positive
definite.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : No EM update of constrained US structure</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : US updates modified 1 times in iteration 7 to remain positive
definite.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = prd_val ~ var, random = ~us(var):gen + env:var + :
Warning : No EM update of constrained US structure</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mt_mod <span class="ot">&lt;-</span> <span class="fu">update</span>(mt_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Extract variance components</p>
<p>Convert variance components into a matrix</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract unique variables</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">unique</span>(blues.na<span class="sc">$</span>var)) </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>mat_varcomp <span class="ot">&lt;-</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(mt_mod)<span class="sc">$</span>varcomp) <span class="sc">|&gt;</span> <span class="co"># Get variance components</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(component) <span class="sc">|&gt;</span>  <span class="co"># Select the column containing the variance components</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">'varcomp'</span>) <span class="sc">|&gt;</span>  <span class="co"># Convert row names to a separate column</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(varcomp, <span class="fu">paste</span>(var, <span class="at">collapse =</span> <span class="st">'|'</span>))) <span class="sc">|&gt;</span>  <span class="co"># Filter rows that contain variables</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">varcomp=</span><span class="fu">str_replace_all</span>(varcomp,<span class="st">'var:gen!var_'</span>,<span class="st">''</span>)) <span class="sc">|&gt;</span>  <span class="co"># Replace specific patterns</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(varcomp, <span class="fu">c</span>(<span class="st">'var1'</span>,<span class="st">'var2'</span>),<span class="at">sep =</span> <span class="st">':'</span>) <span class="sc">|&gt;</span>  <span class="co"># Split the 'varcomp' column into two separate columns</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(var2,component) <span class="sc">|&gt;</span>  <span class="co"># Spread the 'component' values into separate columns</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">'var1'</span>) <span class="sc">|&gt;</span>  <span class="co"># Use 'var1' column as row names</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span>  <span class="co"># Convert the resulting data frame to a matrix</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()  <span class="co"># Transpose the matrix</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>mat_varcomp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             grain_yield heading_time plant_height test_weight
grain_yield     100592.5   148.668876   212.852659  727.639149
heading_time          NA     3.221801     2.676113   -1.481284
plant_height          NA           NA    15.572863   10.923881
test_weight           NA           NA           NA  180.404697</code></pre>
</div>
</div>
<p>Function to calculate genetic correlations from the matrix of variance components</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate genetic correlations</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>calc_gen_corr <span class="ot">&lt;-</span> <span class="cf">function</span>(mat) {</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the number of rows in the matrix</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mat)  </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a square matrix to store the genetic correlations, initialized with 1's</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  genetic_corr_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> n,  </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">rownames</span>(mat), <span class="fu">colnames</span>(mat)))  <span class="co"># Set the row and column names</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n <span class="sc">-</span> <span class="dv">1</span>)) {  <span class="co"># Loop over the rows of the matrix (excluding the last row)</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> (i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n) {  <span class="co"># Loop over the columns of the matrix starting from i+1 to n</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>      genetic_corr <span class="ot">&lt;-</span> mat[i, j] <span class="sc">/</span> (<span class="fu">sqrt</span>(mat[i, i]) <span class="sc">*</span> <span class="fu">sqrt</span>(mat[j, j]))  <span class="co"># Calculate the genetic correlation</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Assign the calculated genetic correlation to the corresponding cell in the upper triangle of the matrix</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>      genetic_corr_mat[i, j] <span class="ot">&lt;-</span> genetic_corr</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Assign the same value to the corresponding cell in the lower triangle of the matrix</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>      genetic_corr_mat[j, i] <span class="ot">&lt;-</span> genetic_corr</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(genetic_corr_mat)  <span class="co"># Return the matrix containing the genetic correlations</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate genetic correlations</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>genetic_corr <span class="ot">&lt;-</span> <span class="fu">calc_gen_corr</span>(mat_varcomp)  <span class="co"># Call the function with the input matrix</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>genetic_corr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             grain_yield heading_time plant_height test_weight
grain_yield    1.0000000   0.26114865    0.1700638  0.17080840
heading_time   0.2611487   1.00000000    0.3778077 -0.06144196
plant_height   0.1700638   0.37780767    1.0000000  0.20609564
test_weight    0.1708084  -0.06144196    0.2060956  1.00000000</code></pre>
</div>
</div>
</section>
<section id="figure" class="level3">
<h3 class="anchored" data-anchor-id="figure">Figure</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(genetic_corr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Grain yield'</span>,<span class="st">'Heading time'</span>,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Plant height'</span>,<span class="st">'Test weight'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(genetic_corr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Grain yield'</span>,<span class="st">'Heading time'</span>,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Plant height'</span>,<span class="st">'Test weight'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a color palette transitioning from orange to blue</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>my_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"#13294B"</span>, <span class="st">"white"</span>,<span class="st">"#FF552E"</span>))(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the correlation matrix with the specified color palette</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tiff</span>(<span class="st">"figures/gen_corr.tiff"</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">res =</span> <span class="dv">320</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(genetic_corr, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, <span class="at">addCoef.col =</span> <span class="cn">TRUE</span>, </span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">addgrid =</span> <span class="cn">FALSE</span>, <span class="at">outline =</span> <span class="st">"black"</span>,  </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.cex =</span> <span class="dv">1</span>, <span class="at">tl.srt =</span> <span class="dv">0</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>, </span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">cl.cex =</span> <span class="dv">1</span>, <span class="at">cl.align.text =</span> <span class="st">"l"</span>,</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">number.cex =</span> <span class="dv">1</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>),</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> my_palette)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>quartz_off_screen 
                2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(genetic_corr, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, <span class="at">addCoef.col =</span> <span class="cn">TRUE</span>, </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">addgrid =</span> <span class="cn">FALSE</span>, <span class="at">outline =</span> <span class="st">"black"</span>,  </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.cex =</span> <span class="dv">1</span>, <span class="at">tl.srt =</span> <span class="dv">0</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>, </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">cl.cex =</span> <span class="dv">1</span>, <span class="at">cl.align.text =</span> <span class="st">"l"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">number.cex =</span> <span class="dv">1</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> my_palette)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="wheat_genetic_trends_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="trend-analysis" class="level2">
<h2 class="anchored" data-anchor-id="trend-analysis">Trend analysis</h2>
<section id="data-1" class="level3">
<h3 class="anchored" data-anchor-id="data-1">Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>dat_trend_21yr <span class="ot">&lt;-</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  blues <span class="sc">|&gt;</span> <span class="co"># blues from single trial analysis</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">check=</span><span class="fu">ifelse</span>(gen<span class="sc">==</span><span class="st">'Kaskaskia'</span>,T,F), <span class="co"># Assign check &amp; entry genotypes</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">check_f=</span><span class="fu">as.factor</span>(check)) <span class="sc">|&gt;</span> <span class="co"># Check as factor</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gidyr)<span class="sc">|</span>check<span class="sc">==</span>T) <span class="sc">|&gt;</span> <span class="co"># Remove genotypes without gidyr</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(check<span class="sc">==</span>T<span class="sc">|</span>year_n<span class="sc">==</span>gidyr_n) <span class="sc">|&gt;</span> <span class="co"># filter checks &amp; entries to keep entry data only for the first year it was tested</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,313
Columns: 13
$ env       &lt;fct&gt; Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, …
$ year      &lt;fct&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ year_n    &lt;dbl&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ loc       &lt;fct&gt; "Brownstown, IL", "Brownstown, IL", "Brownstown, IL", "Brown…
$ gen       &lt;fct&gt; 98-11276W, 98-11276W, 98-11276W, 98-11442, 98-11442, 98-1144…
$ gidyr     &lt;fct&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ gidyr_n   &lt;dbl&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ var       &lt;fct&gt; grain_yield, plant_height, test_weight, grain_yield, plant_h…
$ prd_val   &lt;dbl&gt; 4992.25927, 78.74000, 737.99358, 4472.18556, 80.43333, 711.8…
$ std_error &lt;dbl&gt; 334.739054, 2.974737, 6.180723, 334.739054, 2.974737, 6.1807…
$ wt        &lt;dbl&gt; 8.924569e-06, 1.130063e-01, 2.617710e-02, 8.924569e-06, 1.13…
$ check     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ check_f   &lt;fct&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…</code></pre>
</div>
</div>
</section>
<section id="models" class="level3">
<h3 class="anchored" data-anchor-id="models">Models</h3>
<p>Toy data used to create and test the function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span> dat_trend_21yr<span class="sc">|&gt;</span><span class="fu">filter</span>(var<span class="sc">==</span><span class="st">'grain_yield'</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6,047
Columns: 13
$ env       &lt;fct&gt; Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, Adv_Brt_01, …
$ year      &lt;fct&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ year_n    &lt;dbl&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ loc       &lt;fct&gt; "Brownstown, IL", "Brownstown, IL", "Brownstown, IL", "Brown…
$ gen       &lt;fct&gt; 98-11276W, 98-11442, 98-11551, 98-11649, 98-12071, 98-12141,…
$ gidyr     &lt;fct&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ gidyr_n   &lt;dbl&gt; 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, 2001, …
$ var       &lt;fct&gt; grain_yield, grain_yield, grain_yield, grain_yield, grain_yi…
$ prd_val   &lt;dbl&gt; 4992.259, 4472.186, 4153.865, 4745.673, 4220.083, 4239.049, …
$ std_error &lt;dbl&gt; 334.7391, 334.7391, 334.7391, 334.7391, 410.6393, 334.7391, …
$ wt        &lt;dbl&gt; 8.924569e-06, 8.924569e-06, 8.924569e-06, 8.924569e-06, 5.93…
$ check     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ check_f   &lt;fct&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…</code></pre>
</div>
</div>
<p>Function to run the genetic, environmental, and phenotypic trends</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mod.trends <span class="ot">&lt;-</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(dat){</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(dat<span class="sc">$</span>variable)) <span class="co"># variable being analyzed</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">'heading_time'</span> <span class="sc">%in%</span> var) { <span class="co"># models for heading time</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Genetic trend</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>      mod_gen <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed=</span>prd_val <span class="sc">~</span>gidyr_n <span class="sc">+</span> check_f,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">random=</span><span class="sc">~</span>year <span class="sc">+</span> <span class="fu">at</span>(year,<span class="st">'2021'</span>)<span class="sc">:</span>gen <span class="sc">+</span> <span class="fu">at</span>(year,<span class="st">'2021'</span>)<span class="sc">:</span>loc,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">weights=</span>wt, <span class="at">family=</span><span class="fu">asr_gaussian</span>(<span class="at">dispersion=</span><span class="dv">1</span>),</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.action=</span><span class="fu">na.method</span>(<span class="st">'omit'</span>), <span class="at">data=</span>dat)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>      mod_gen <span class="ot">&lt;-</span> <span class="fu">update</span>(mod_gen)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Point estimates of gidyr</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      mod_gen_pt <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed=</span>prd_val <span class="sc">~</span>gidyr <span class="sc">+</span> check_f,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">random=</span><span class="sc">~</span>year<span class="sc">+</span><span class="fu">at</span>(year,<span class="st">'2021'</span>)<span class="sc">:</span>gen<span class="sc">+</span><span class="fu">at</span>(year,<span class="st">'2021'</span>)<span class="sc">:</span>loc,</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">weights=</span>wt, <span class="at">family=</span><span class="fu">asr_gaussian</span>(<span class="at">dispersion=</span><span class="dv">1</span>),</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">na.action=</span><span class="fu">na.method</span>(<span class="st">'omit'</span>), <span class="at">data=</span>dat)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>      mod_gen_pt <span class="ot">&lt;-</span> <span class="fu">update</span>(mod_gen_pt)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Environmental trend - check only</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>      mod_env <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed=</span>prd_val <span class="sc">~</span>year_n,</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">random=</span><span class="sc">~</span><span class="fu">at</span>(year,<span class="st">'2021'</span>)<span class="sc">:</span>gen<span class="sc">+</span><span class="fu">at</span>(year,<span class="st">'2021'</span>)<span class="sc">:</span>loc,</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">weights=</span>wt, <span class="at">family=</span><span class="fu">asr_gaussian</span>(<span class="at">dispersion=</span><span class="dv">1</span>),</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.action=</span><span class="fu">na.method</span>(<span class="st">'omit'</span>),<span class="at">data=</span>dat<span class="sc">|&gt;</span><span class="fu">filter</span>(check<span class="sc">==</span>T))</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>      mod_env <span class="ot">&lt;-</span> <span class="fu">update</span>(mod_env)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Phenotypic trend - entry only</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>      mod_pheno <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed=</span>prd_val <span class="sc">~</span>gidyr_n,</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>                          <span class="at">random=</span><span class="sc">~</span><span class="fu">at</span>(year,<span class="st">'2021'</span>)<span class="sc">:</span>gen<span class="sc">+</span><span class="fu">at</span>(year,<span class="st">'2021'</span>)<span class="sc">:</span>loc,</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">weights=</span>wt, <span class="at">family=</span><span class="fu">asr_gaussian</span>(<span class="at">dispersion=</span><span class="dv">1</span>),</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">na.action=</span><span class="fu">na.method</span>(<span class="st">'omit'</span>),<span class="at">data=</span>dat<span class="sc">|&gt;</span><span class="fu">filter</span>(check<span class="sc">==</span>F))</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>      mod_pheno <span class="ot">&lt;-</span> <span class="fu">update</span>(mod_pheno)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{ <span class="co"># models for grain yield, test weight, and plant height</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Genetic trend</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>      mod_gen <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed=</span>prd_val<span class="sc">~</span> gidyr_n<span class="sc">+</span> check_f <span class="sc">+</span> loc <span class="sc">+</span> check_f<span class="sc">:</span>loc,</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">random=</span><span class="sc">~</span> year <span class="sc">+</span> gen<span class="sc">:</span>year <span class="sc">+</span> gen<span class="sc">:</span>loc,</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>                        <span class="at">weights=</span>wt, <span class="at">family=</span><span class="fu">asr_gaussian</span>(<span class="at">dispersion=</span><span class="dv">1</span>),</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.action=</span><span class="fu">na.method</span>(<span class="st">'omit'</span>), <span class="at">data=</span>dat)</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>      mod_gen <span class="ot">&lt;-</span> <span class="fu">update</span>(mod_gen)</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Point estimates of gidyr</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>      mod_gen_pt <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed=</span>prd_val<span class="sc">~</span> gidyr<span class="sc">+</span> check_f <span class="sc">+</span> loc <span class="sc">+</span> check_f<span class="sc">:</span>loc,</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>                           <span class="at">random=</span><span class="sc">~</span> year <span class="sc">+</span> gen<span class="sc">:</span>year <span class="sc">+</span> gen<span class="sc">:</span>loc,</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>                           <span class="at">weights=</span>wt, <span class="at">family=</span><span class="fu">asr_gaussian</span>(<span class="at">dispersion=</span><span class="dv">1</span>),</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>                           <span class="at">na.action=</span><span class="fu">na.method</span>(<span class="st">'omit'</span>), <span class="at">data=</span>dat)</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>      mod_gen_pt <span class="ot">&lt;-</span> <span class="fu">update</span>(mod_gen_pt)</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Environmental trend - check only</span></span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>      mod_env <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed=</span>prd_val<span class="sc">~</span> year_n, </span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>                        <span class="at">random=</span><span class="sc">~</span> loc<span class="sc">:</span>year <span class="sc">+</span> gen<span class="sc">:</span>loc <span class="sc">+</span> gen<span class="sc">:</span>year,</span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>                        <span class="at">weights=</span>wt, <span class="at">family=</span><span class="fu">asr_gaussian</span>(<span class="at">dispersion=</span><span class="dv">1</span>),</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.action=</span><span class="fu">na.method</span>(<span class="st">'omit'</span>),</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data=</span>dat<span class="sc">|&gt;</span><span class="fu">filter</span>(check<span class="sc">==</span>T))</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>      mod_env <span class="ot">&lt;-</span> <span class="fu">update</span>(mod_env)</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Phenotypic trend - entry only</span></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>      mod_pheno <span class="ot">&lt;-</span> <span class="fu">asreml</span>(<span class="at">fixed=</span>prd_val<span class="sc">~</span> gidyr_n <span class="sc">+</span> loc, </span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>                          <span class="at">random=</span><span class="sc">~</span> year <span class="sc">+</span> gen<span class="sc">:</span>loc <span class="sc">+</span> gen<span class="sc">:</span>year,</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>                          <span class="at">weights=</span>wt, <span class="at">family=</span><span class="fu">asr_gaussian</span>(<span class="at">dispersion=</span><span class="dv">1</span>),</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>                          <span class="at">na.action=</span><span class="fu">na.method</span>(<span class="st">'omit'</span>),</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data=</span>dat<span class="sc">|&gt;</span><span class="fu">filter</span>(check<span class="sc">==</span>F))</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>      mod_pheno <span class="ot">&lt;-</span> <span class="fu">update</span>(mod_pheno)</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Genetic trend figure data</span></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Predict genetic trend line</span></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>    gen_line <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_gen,  <span class="at">classify=</span><span class="st">'gidyr_n:check_f'</span>,</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels=</span><span class="fu">list</span>(<span class="at">check_f=</span><span class="st">"FALSE"</span>,</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">gidyr_n=</span><span class="fu">c</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year_n))))<span class="sc">$</span>pvals <span class="sc">|&gt;</span></span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">pval_line=</span>predicted_value, <span class="at">se_line=</span>std_error) <span class="sc">|&gt;</span></span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">gidyr=</span><span class="fu">factor</span>(gidyr_n),</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>             <span class="at">ci1=</span>pval_line<span class="fl">+1.96</span><span class="sc">*</span>se_line, <span class="at">ci2=</span>pval_line<span class="fl">-1.96</span><span class="sc">*</span>se_line)</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Predict genetic trend points</span></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>    gen_pts <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_gen_pt, <span class="at">classify=</span><span class="st">'gidyr:check_f'</span>,</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels=</span><span class="fu">list</span>(<span class="at">check_f=</span><span class="st">"FALSE"</span>,</span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">gidyr=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year_n)))))<span class="sc">$</span>pvals <span class="sc">|&gt;</span></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">pval_point=</span>predicted_value,<span class="at">se_point=</span>std_error)</span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Join trend line and point predictions</span></span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>    dat_gen_trend <span class="ot">&lt;-</span> <span class="fu">left_join</span>(gen_line, gen_pts) <span class="sc">|&gt;</span></span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nest</span>(<span class="at">dat_gen_trend=</span><span class="fu">everything</span>())</span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wald test of fixed effects</span></span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Function to convert asreml wald to df</span></span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>    wald_df <span class="ot">&lt;-</span> <span class="cf">function</span>(mod,trend){</span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>      aov_df <span class="ot">&lt;-</span> <span class="fu">wald</span>(mod) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">rownames_to_column</span>(<span class="st">'term'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">trend=</span>trend) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(trend)</span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(aov_df)</span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Bind all trends to the same df</span></span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>    wald <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">wald_df</span>(mod_gen,<span class="st">'gen'</span>), </span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">wald_df</span>(mod_env,<span class="st">'env'</span>), </span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">wald_df</span>(mod_pheno,<span class="st">'pheno'</span>))</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fixed effects estimates</span></span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Function to convert asreml summary to df</span></span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>    fixeff_df <span class="ot">&lt;-</span> <span class="cf">function</span>(mod,trend){</span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>      fixeff_df <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod, <span class="at">coef=</span><span class="cn">TRUE</span>)<span class="sc">$</span>coef.fixed <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rownames_to_column</span>(<span class="st">'term'</span>) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">trend=</span>trend) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(trend)</span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fixeff_df)</span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Bind all trends to the same df</span></span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a>    coef_fixeff <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">fixeff_df</span>(mod_gen,<span class="st">'gen'</span>), </span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">fixeff_df</span>(mod_env,<span class="st">'env'</span>), </span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">fixeff_df</span>(mod_pheno,<span class="st">'pheno'</span>))</span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Raw fixed effects</span></span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a>    raw_fixeff <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="at">wald=</span>wald,<span class="at">coef_fixeff=</span>coef_fixeff),<span class="at">.id=</span><span class="st">'id'</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a>      <span class="fu">clean_names</span>()<span class="sc">|&gt;</span><span class="fu">nest</span>(<span class="at">raw_fixeff=</span><span class="fu">everything</span>())</span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Summarized fixed effects</span></span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a>    fixeff <span class="ot">&lt;-</span> <span class="fu">full_join</span>(wald,coef_fixeff,<span class="at">by=</span><span class="fu">c</span>(<span class="st">'trend'</span>, <span class="st">'term'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">'Intercept|residual'</span>,term)) <span class="sc">|&gt;</span> </span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(sum_of_sq,z_ratio)) <span class="sc">|&gt;</span> <span class="fu">nest</span>(<span class="at">fixeff=</span><span class="fu">everything</span>())</span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Variance components</span></span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Function to convert varcomp to df</span></span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a>    varcomp_df <span class="ot">&lt;-</span> <span class="cf">function</span>(mod,trend){</span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a>      varcomp_df <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>varcomp <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rownames_to_column</span>(<span class="st">'term'</span>) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">trend=</span>trend) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(trend)</span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(varcomp_df)</span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Bind rows</span></span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a>    varcomp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">varcomp_df</span>(mod_gen,<span class="st">'gen'</span>), </span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">varcomp_df</span>(mod_env,<span class="st">'env'</span>), </span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">varcomp_df</span>(mod_pheno,<span class="st">'pheno'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> <span class="fu">nest</span>(<span class="at">varcomp=</span><span class="fu">everything</span>())</span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">dat_gen_trend=</span>dat_gen_trend,</span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fixeff=</span>fixeff,</span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a>                      <span class="at">varcomp=</span>varcomp))</span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="run-the-model-for-all-variables" class="level4">
<h4 class="anchored" data-anchor-id="run-the-model-for-all-variables">Run the model for all variables</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>out_trend <span class="ot">&lt;-</span> dat_trend_21yr <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable=</span><span class="fu">as.character</span>(var)) <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(var) <span class="sc">|&gt;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trends=</span><span class="fu">map</span>(data,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">~</span><span class="fu">mod.trends</span>(.x))) <span class="sc">|&gt;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">|&gt;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(trends) <span class="sc">|&gt;</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Terms with zero df listed in attribute 'zerodf' of the wald table.
Terms with zero df listed in attribute 'zerodf' of the wald table.
Terms with zero df listed in attribute 'zerodf' of the wald table.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(check_f, status, gidyr)`
Terms with zero df listed in attribute 'zerodf' of the wald table.
Terms with zero df listed in attribute 'zerodf' of the wald table.
Terms with zero df listed in attribute 'zerodf' of the wald table.
Joining with `by = join_by(check_f, status, gidyr)`
Terms with zero df listed in attribute 'zerodf' of the wald table.
Terms with zero df listed in attribute 'zerodf' of the wald table.
Terms with zero df listed in attribute 'zerodf' of the wald table.
Joining with `by = join_by(check_f, status, gidyr)`
Terms with zero df listed in attribute 'zerodf' of the wald table.
Terms with zero df listed in attribute 'zerodf' of the wald table.
Terms with zero df listed in attribute 'zerodf' of the wald table.
Joining with `by = join_by(check_f, status, gidyr)`</code></pre>
</div>
</div>
</section>
</section>
<section id="figures" class="level3">
<h3 class="anchored" data-anchor-id="figures">Figures</h3>
<section id="genetic-trend" class="level4">
<h4 class="anchored" data-anchor-id="genetic-trend">Genetic trend</h4>
<p>Data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>gt_dat <span class="ot">&lt;-</span> out_trend <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(var,dat_gen_trend) <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>() <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(dat_gen_trend)`.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 11
$ var        &lt;fct&gt; grain_yield, grain_yield, grain_yield, grain_yield, grain_y…
$ gidyr_n    &lt;dbl&gt; 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,…
$ check_f    &lt;fct&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
$ pval_line  &lt;dbl&gt; 4636.51558, 4669.48990, 4702.46421, 4735.43853, 4768.41284,…
$ se_line    &lt;dbl&gt; 124.841188, 122.520337, 120.398738, 118.487093, 116.795712,…
$ status     &lt;chr&gt; "Estimable", "Estimable", "Estimable", "Estimable", "Estima…
$ gidyr      &lt;fct&gt; 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,…
$ ci1        &lt;dbl&gt; 4881.20431, 4909.62976, 4938.44574, 4967.67323, 4997.33244,…
$ ci2        &lt;dbl&gt; 4391.82685, 4429.35004, 4466.48269, 4503.20383, 4539.49325,…
$ pval_point &lt;dbl&gt; 4399.53847, 4593.05497, 4969.70534, 4984.50952, 4719.59172,…
$ se_point   &lt;dbl&gt; 157.448429, 159.051092, 165.503103, 159.579686, 172.296402,…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>trends <span class="ot">&lt;-</span> out_trend <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(var, fixeff) <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(fixeff) <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">'year_n'</span>,<span class="st">'gidyr_n'</span>,<span class="st">'at(check_f, FALSE):gidyr_n'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">slope=</span><span class="fu">round</span>(solution,<span class="dv">3</span>),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">se=</span><span class="fu">round</span>(std_error,<span class="dv">3</span>),</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">sign=</span><span class="fu">ifelse</span>(pr_chisq<span class="sc">&lt;</span><span class="fl">0.001</span>,<span class="st">'***'</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(pr_chisq<span class="sc">&lt;</span><span class="fl">0.01</span>,<span class="st">'**'</span>,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(pr_chisq<span class="sc">&lt;</span><span class="fl">0.05</span>,<span class="st">'*'</span>,<span class="st">''</span>)))) <span class="sc">|&gt;</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 12
Columns: 11
$ var            &lt;fct&gt; grain_yield, grain_yield, grain_yield, plant_height, pl…
$ trend          &lt;chr&gt; "gen", "env", "pheno", "gen", "env", "pheno", "gen", "e…
$ term           &lt;chr&gt; "gidyr_n", "year_n", "gidyr_n", "gidyr_n", "year_n", "g…
$ df             &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
$ wald_statistic &lt;dbl&gt; 5.435316e+01, 6.046437e-01, 1.401128e+00, 2.386756e+00,…
$ pr_chisq       &lt;dbl&gt; 1.675327e-13, 4.368117e-01, 2.365348e-01, 1.223673e-01,…
$ solution       &lt;dbl&gt; 32.972738916, -16.087711715, 11.085538465, -0.009675761…
$ std_error      &lt;dbl&gt; 5.418740275, 20.689238207, 18.426292178, 0.095910500, 0…
$ slope          &lt;dbl&gt; 32.973, -16.088, 11.086, -0.010, -0.097, -0.182, 0.908,…
$ se             &lt;dbl&gt; 5.419, 20.689, 18.426, 0.096, 0.309, 0.290, 0.244, 0.83…
$ sign           &lt;chr&gt; "***", "", "", "", "", "", "***", "***", "**", "***", "…</code></pre>
</div>
</div>
<section id="grain-yield" class="level5">
<h5 class="anchored" data-anchor-id="grain-yield">Grain yield</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>slope_gy <span class="ot">&lt;-</span> trends <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(var<span class="sc">==</span><span class="st">"grain_yield"</span><span class="sc">&amp;</span>trend<span class="sc">==</span><span class="st">"gen"</span>) <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label=</span><span class="fu">paste</span>(slope, <span class="st">'±'</span>, se, <span class="st">'kg ha&lt;sup&gt;-1&lt;/sup&gt; yr&lt;sup&gt;-1&lt;/sup&gt;'</span>, sign)) <span class="sc">|&gt;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 12
$ var            &lt;fct&gt; grain_yield
$ trend          &lt;chr&gt; "gen"
$ term           &lt;chr&gt; "gidyr_n"
$ df             &lt;dbl&gt; 1
$ wald_statistic &lt;dbl&gt; 54.35316
$ pr_chisq       &lt;dbl&gt; 1.675327e-13
$ solution       &lt;dbl&gt; 32.97274
$ std_error      &lt;dbl&gt; 5.41874
$ slope          &lt;dbl&gt; 32.973
$ se             &lt;dbl&gt; 5.419
$ sign           &lt;chr&gt; "***"
$ label          &lt;chr&gt; "32.973 ± 5.419 kg ha&lt;sup&gt;-1&lt;/sup&gt; yr&lt;sup&gt;-1&lt;/sup&gt; ***"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>gt_dat <span class="sc">|&gt;</span> <span class="fu">filter</span>(var<span class="sc">==</span><span class="st">"grain_yield"</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(gidyr_n)) <span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>ci1),<span class="at">color=</span><span class="st">'#13294B'</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>ci2),<span class="at">color=</span><span class="st">'#13294B'</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci2, <span class="at">ymax =</span> ci1), <span class="at">fill =</span> <span class="st">'#13294B'</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>pval_point), <span class="at">color=</span><span class="st">'#13294B'</span>, <span class="at">fill=</span><span class="st">'#13294B'</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>gidyr_n,<span class="at">y=</span>pval_line),<span class="at">color=</span><span class="st">'#FF552E'</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name=</span> <span class="st">"Year"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2001</span>,<span class="dv">2021</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"Grain yield (kg ha"</span><span class="sc">^-</span><span class="dv">1</span><span class="sc">*</span><span class="st">")"</span>),</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">4200</span>,<span class="dv">5800</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">3000</span>, <span class="dv">7000</span>, <span class="at">by =</span> <span class="dv">250</span>)) <span class="sc">+</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(<span class="at">data=</span>slope_gy,<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">2001</span>,<span class="at">y=</span><span class="dv">5625</span>,<span class="at">label=</span>label), <span class="at">hjust=</span><span class="dv">0</span>, <span class="at">label.color =</span> <span class="cn">NA</span>, <span class="at">size =</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>, <span class="at">vjust=</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">'none'</span>, <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="wheat_genetic_trends_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/gy.tiff"</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">dpi=</span><span class="dv">320</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_point()`).</code></pre>
</div>
</div>
</section>
<section id="test-weight" class="level5">
<h5 class="anchored" data-anchor-id="test-weight">Test weight</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>slope_tw <span class="ot">&lt;-</span> trends <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(var<span class="sc">==</span><span class="st">"test_weight"</span><span class="sc">&amp;</span>trend<span class="sc">==</span><span class="st">"gen"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label=</span><span class="fu">paste</span>(slope, <span class="st">'±'</span>, se,<span class="st">'g L&lt;sup&gt;-1&lt;/sup&gt; yr&lt;sup&gt;-1&lt;/sup&gt;'</span>, sign)) <span class="sc">|&gt;</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 12
$ var            &lt;fct&gt; test_weight
$ trend          &lt;chr&gt; "gen"
$ term           &lt;chr&gt; "gidyr_n"
$ df             &lt;dbl&gt; 1
$ wald_statistic &lt;dbl&gt; 17.82807
$ pr_chisq       &lt;dbl&gt; 2.417899e-05
$ solution       &lt;dbl&gt; 0.9080751
$ std_error      &lt;dbl&gt; 0.2439648
$ slope          &lt;dbl&gt; 0.908
$ se             &lt;dbl&gt; 0.244
$ sign           &lt;chr&gt; "***"
$ label          &lt;chr&gt; "0.908 ± 0.244 g L&lt;sup&gt;-1&lt;/sup&gt; yr&lt;sup&gt;-1&lt;/sup&gt; ***"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>gt_dat <span class="sc">|&gt;</span> <span class="fu">filter</span>(var<span class="sc">==</span><span class="st">"test_weight"</span>) <span class="sc">|&gt;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(gidyr_n)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>ci1),<span class="at">color=</span><span class="st">'#13294B'</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>ci2),<span class="at">color=</span><span class="st">'#13294B'</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci2, <span class="at">ymax =</span> ci1), <span class="at">fill =</span> <span class="st">'#13294B'</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>pval_point), <span class="at">color=</span><span class="st">'#13294B'</span>, <span class="at">fill=</span><span class="st">'#13294B'</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>gidyr_n,<span class="at">y=</span>pval_line),<span class="at">color=</span><span class="st">'#FF552E'</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name=</span> <span class="st">"Year"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2001</span>,<span class="dv">2021</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"Test weight (g L"</span><span class="sc">^-</span><span class="dv">1</span><span class="sc">*</span><span class="st">")"</span>),</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">718</span>,<span class="dv">768</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">720</span>, <span class="dv">770</span>, <span class="at">by =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(<span class="at">data=</span>slope_tw,<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">2001</span>,<span class="at">y=</span><span class="fl">762.5</span>,<span class="at">label=</span>label), <span class="at">hjust=</span><span class="dv">0</span>, <span class="at">label.color =</span> <span class="cn">NA</span>, <span class="at">size =</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>, <span class="at">vjust=</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">'none'</span>, <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="wheat_genetic_trends_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/tw.tiff"</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">dpi=</span><span class="dv">320</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_point()`).</code></pre>
</div>
</div>
</section>
<section id="heading-time" class="level5">
<h5 class="anchored" data-anchor-id="heading-time">Heading time</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>slope_ht <span class="ot">&lt;-</span> trends <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(var<span class="sc">==</span><span class="st">"heading_time"</span><span class="sc">&amp;</span>trend<span class="sc">==</span><span class="st">"gen"</span>) <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label=</span><span class="fu">paste</span>(slope, <span class="st">'±'</span>, se,<span class="st">'d yr&lt;sup&gt;-1&lt;/sup&gt;'</span>, sign)) <span class="sc">|&gt;</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 12
$ var            &lt;fct&gt; heading_time
$ trend          &lt;chr&gt; "gen"
$ term           &lt;chr&gt; "gidyr_n"
$ df             &lt;dbl&gt; 1
$ wald_statistic &lt;dbl&gt; 1010.729
$ pr_chisq       &lt;dbl&gt; 0
$ solution       &lt;dbl&gt; -0.0711345
$ std_error      &lt;dbl&gt; 0.01655642
$ slope          &lt;dbl&gt; -0.071
$ se             &lt;dbl&gt; 0.017
$ sign           &lt;chr&gt; "***"
$ label          &lt;chr&gt; "-0.071 ± 0.017 d yr&lt;sup&gt;-1&lt;/sup&gt; ***"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>gt_dat <span class="sc">|&gt;</span> <span class="fu">filter</span>(var<span class="sc">==</span><span class="st">"heading_time"</span>) <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(gidyr_n)) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>ci1),<span class="at">color=</span><span class="st">'#13294B'</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>ci2),<span class="at">color=</span><span class="st">'#13294B'</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci2, <span class="at">ymax =</span> ci1), <span class="at">fill =</span> <span class="st">'#13294B'</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>pval_point), <span class="at">color=</span><span class="st">'#13294B'</span>, <span class="at">fill=</span><span class="st">'#13294B'</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>gidyr_n,<span class="at">y=</span>pval_line),<span class="at">color=</span><span class="st">'#FF552E'</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name=</span> <span class="st">"Year"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2001</span>,<span class="dv">2021</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"Heading time (JD)"</span>),</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">129</span>,<span class="dv">139</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">130</span>, <span class="dv">138</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(<span class="at">data=</span>slope_ht,<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">2001</span>,<span class="at">y=</span><span class="dv">138</span>,<span class="at">label=</span>label), <span class="at">hjust=</span><span class="dv">0</span>, <span class="at">label.color =</span> <span class="cn">NA</span>, <span class="at">size =</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>, <span class="at">vjust=</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">'none'</span>, <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="wheat_genetic_trends_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/ht.tiff"</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">dpi=</span><span class="dv">320</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_point()`).</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="tables" class="level3">
<h3 class="anchored" data-anchor-id="tables">Tables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>trends <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value=</span><span class="fu">paste</span>(slope, <span class="st">'±'</span>, se, sign)) <span class="sc">|&gt;</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(trend, var, value) <span class="sc">|&gt;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> trend, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var=</span><span class="fu">c</span>( <span class="st">'Grain yield'</span>, <span class="st">'Plant height'</span>, <span class="st">'Test weight'</span>, <span class="st">'Heading time'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">"tables/table2.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">'Trait'</span>,<span class="st">'Genetic'</span>,<span class="st">'Nongenetic'</span>,<span class="st">'Total phenotypic'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Trait</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Genetic</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Nongenetic</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Total phenotypic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grain yield</td>
<td style="text-align: left;">32.973 ± 5.419 ***</td>
<td style="text-align: left;">-16.088 ± 20.689</td>
<td style="text-align: left;">11.086 ± 18.426</td>
</tr>
<tr class="even">
<td style="text-align: left;">Plant height</td>
<td style="text-align: left;">-0.01 ± 0.096</td>
<td style="text-align: left;">-0.097 ± 0.309</td>
<td style="text-align: left;">-0.182 ± 0.29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Test weight</td>
<td style="text-align: left;">0.908 ± 0.244 ***</td>
<td style="text-align: left;">-3.277 ± 0.837 ***</td>
<td style="text-align: left;">-2.386 ± 0.769 **</td>
</tr>
<tr class="even">
<td style="text-align: left;">Heading time</td>
<td style="text-align: left;">-0.071 ± 0.017 ***</td>
<td style="text-align: left;">0.19 ± 0.016 ***</td>
<td style="text-align: left;">0.091 ± 0.002 ***</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="il-wheat-area-map" class="level2">
<h2 class="anchored" data-anchor-id="il-wheat-area-map">IL wheat area map</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># Simple Features for R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster) <span class="co"># Geographic Data Analysis and Modeling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'raster'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial) <span class="co"># Spatial Data Framework for ggplot2</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># ColorBrewer Palettes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>loc_coord <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">loc=</span><span class="fu">c</span>(<span class="st">"Brownstown"</span>, <span class="st">"Carmi"</span>, <span class="st">"Neoga"</span>, <span class="st">"Ridgway"</span>, <span class="st">"St. Jacob"</span>, <span class="st">"Urbana"</span>),</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">lat=</span><span class="fu">c</span>(<span class="fl">38.9948827</span>,<span class="fl">38.08553</span>,<span class="fl">39.23274</span>,<span class="fl">37.79930</span>,<span class="fl">38.74573</span>,<span class="fl">40.05833</span>),</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">long=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">88.95961</span>,<span class="sc">-</span><span class="fl">88.19441</span>,<span class="sc">-</span><span class="fl">88.38207</span>,<span class="sc">-</span><span class="fl">88.27799</span>,<span class="sc">-</span><span class="fl">89.78045</span>,<span class="sc">-</span><span class="fl">88.22937</span>)) <span class="sc">|&gt;</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6
Columns: 3
$ loc  &lt;chr&gt; "Brownstown", "Carmi", "Neoga", "Ridgway", "St. Jacob", "Urbana"
$ lat  &lt;dbl&gt; 38.99488, 38.08553, 39.23274, 37.79930, 38.74573, 40.05833
$ long &lt;dbl&gt; -88.95961, -88.19441, -88.38207, -88.27799, -89.78045, -88.22937</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data for the states</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"illinois"</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>highlight_states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"illinois"</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the map data for the specified states</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> states)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>county <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"county"</span>) <span class="sc">|&gt;</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> states) <span class="sc">|&gt;</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subregion=</span><span class="fu">str_replace_all</span>(subregion,<span class="st">" "</span>,<span class="st">""</span>),</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">subregion=</span><span class="fu">str_replace_all</span>(subregion,<span class="st">"[.]"</span>,<span class="st">""</span>))</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>wheat_ac <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/2022_fsa_acres_web_082222.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character,<span class="sc">~</span><span class="fu">tolower</span>(.)) <span class="sc">|&gt;</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Crop<span class="sc">%in%</span><span class="st">"wheat"</span>) <span class="sc">|&gt;</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Planted.Acres=</span><span class="fu">str_replace</span>(Planted.Acres,<span class="st">","</span>,<span class="st">""</span>),</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Planted.Acres=</span><span class="fu">as.numeric</span>(Planted.Acres)) <span class="sc">|&gt;</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State,County,Crop) <span class="sc">|&gt;</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Planted.Acres=</span><span class="fu">sum</span>(Planted.Acres,<span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region=</span>State,</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">subregion=</span>County,</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">subregion=</span><span class="fu">str_replace_all</span>(subregion,</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="st">"dewitt"</span><span class="ot">=</span><span class="st">"de witt"</span>,<span class="st">"dupage"</span><span class="ot">=</span><span class="st">"du page"</span>,<span class="st">"st. clair"</span><span class="ot">=</span><span class="st">"st clair"</span>,<span class="st">"dekalb"</span><span class="ot">=</span><span class="st">"de kalb"</span> ))) <span class="sc">|&gt;</span></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subregion=</span><span class="fu">str_replace_all</span>(subregion,<span class="st">" "</span>,<span class="st">""</span>),</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">subregion=</span><span class="fu">str_replace_all</span>(subregion,<span class="st">"[.]"</span>,<span class="st">""</span>))<span class="sc">|&gt;</span></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'State', 'County'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,355
Columns: 6
Groups: State, County [2,355]
$ State         &lt;chr&gt; "alabama", "alabama", "alabama", "alabama", "alabama", "…
$ County        &lt;chr&gt; "autauga", "baldwin", "barbour", "blount", "bullock", "b…
$ Crop          &lt;chr&gt; "wheat", "wheat", "wheat", "wheat", "wheat", "wheat", "w…
$ Planted.Acres &lt;dbl&gt; 124.87, 2412.57, 1475.95, 296.69, 105.00, 194.92, 976.78…
$ region        &lt;chr&gt; "alabama", "alabama", "alabama", "alabama", "alabama", "…
$ subregion     &lt;chr&gt; "autauga", "baldwin", "barbour", "blount", "bullock", "b…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom breaks for the classes</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">25000</span>, <span class="dv">50000</span>, <span class="dv">100000</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"&lt; 1000"</span>, <span class="st">"1001 to 5000"</span>, <span class="st">"5001 to 10000"</span>, <span class="st">"10001 to 25000"</span>, <span class="st">"25001 to 50000"</span>, <span class="st">"&gt; 50001"</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>county_ac <span class="ot">&lt;-</span> county <span class="sc">|&gt;</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wheat_ac) <span class="sc">|&gt;</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Planted.Acres =</span> <span class="fu">ifelse</span>(Planted.Acres <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, Planted.Acres)) <span class="sc">|&gt;</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classes =</span> <span class="fu">cut</span>(Planted.Acres, <span class="at">breaks=</span>breaks, <span class="at">labels =</span> labels, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(region, subregion)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,696
Columns: 11
$ long          &lt;dbl&gt; -91.49563, -90.91121, -90.91121, -90.91121, -90.91694, -…
$ lat           &lt;dbl&gt; 40.21018, 40.19299, 40.10704, 39.83775, 39.75754, 39.757…
$ group         &lt;dbl&gt; 561, 561, 561, 561, 561, 561, 561, 561, 561, 561, 561, 5…
$ order         &lt;int&gt; 21883, 21884, 21885, 21886, 21887, 21888, 21889, 21890, …
$ region        &lt;chr&gt; "illinois", "illinois", "illinois", "illinois", "illinoi…
$ subregion     &lt;chr&gt; "adams", "adams", "adams", "adams", "adams", "adams", "a…
$ State         &lt;chr&gt; "illinois", "illinois", "illinois", "illinois", "illinoi…
$ County        &lt;chr&gt; "adams", "adams", "adams", "adams", "adams", "adams", "a…
$ Crop          &lt;chr&gt; "wheat", "wheat", "wheat", "wheat", "wheat", "wheat", "w…
$ Planted.Acres &lt;dbl&gt; 4603.80, 4603.80, 4603.80, 4603.80, 4603.80, 4603.80, 46…
$ classes       &lt;fct&gt; 1001 to 5000, 1001 to 5000, 1001 to 5000, 1001 to 5000, …</code></pre>
</div>
</div>
<section id="plot" class="level3">
<h3 class="anchored" data-anchor-id="plot">Plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> county_ac, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> classes), <span class="at">color =</span> <span class="st">"gray70"</span>) <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">name =</span> <span class="st">"Planted acres"</span>, <span class="at">palette =</span> <span class="st">"Oranges"</span>, <span class="at">na.value =</span> <span class="st">"white"</span>, <span class="at">drop=</span> <span class="cn">TRUE</span>, </span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt; 1000"</span>, <span class="st">"1001 to 5000"</span>, <span class="st">"5001 to 10000"</span>, <span class="st">"10001 to 25000"</span>, <span class="st">"25001 to 50000"</span>, <span class="st">"&gt; 50001"</span>, <span class="st">"Not estimated"</span>)) <span class="sc">+</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> map_data, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> loc_coord, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> <span class="cn">NA</span>), <span class="at">color =</span> <span class="st">"#13294B"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> loc_coord, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat), <span class="at">color =</span> <span class="st">"#13294B"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> loc_coord, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> <span class="cn">NA</span>, <span class="at">label =</span> loc),</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">"#13294B"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x=</span><span class="fu">element_blank</span>(), <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(), <span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>(), <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(), <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">"white"</span>),</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">"white"</span>,<span class="at">color=</span><span class="cn">NA</span>),</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"left"</span>,</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>, <span class="st">"in"</span>)) <span class="sc">+</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">range</span>(loc_coord<span class="sc">$</span>long) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location=</span><span class="st">"bl"</span>,<span class="at">pad_x=</span><span class="fu">unit</span>(<span class="dv">0</span>,<span class="st">"in"</span>),<span class="at">pad_y=</span><span class="fu">unit</span>(<span class="fl">0.2</span>,<span class="st">"in"</span>),</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_nautical,</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>,<span class="st">"in"</span>),<span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>,<span class="st">"in"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="wheat_genetic_trends_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/map.png"</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">dpi =</span> <span class="dv">320</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="st">'data/wheat_genetic_trends.RData'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load('data/wheat_genetic_trends.RData')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>() <span class="sc">-</span> start.time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.173634 mins</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>